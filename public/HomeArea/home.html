<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GrabBike_WebVersion</title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <!-- <link href='https://api.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css' rel='stylesheet' /> -->
    <!-- <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js'></script> -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.js'></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="/HomeArea/home.css" rel='stylesheet' type="text/css">
</head>

<body>
    <div class="mapHome">
        <div class="mapInfo col-sm-12">
            <div id="map" class="ui-widget-content"></div>
            <div id="zoomMap">
                <a onclick="zoomMap()" class="btn btn-sm btn-info">Phóng to bản đồ</a>
            </div>
            <div id="zoomInMap">
                <a onclick="zoomInMap()" class="btn btn-sm btn-info">Phóng nhỏ bản đồ</a>
            </div>
        </div>
        <div class="mapItem col-sm-6">
            <div>
                <a onclick="getLocation()" class="btn btn-sm btn-success">Lấy vị trí hiện tại</a>
            </div>
            <p id="demo"></p>
            <div id='menu'>
                <input id='streets-v11' type='radio' name='rtoggle' value='streets' checked='checked'>
                <label for='streets'>streets</label>
                <input id='light-v10' type='radio' name='rtoggle' value='light'>
                <label for='light'>light</label>
                <input id='dark-v10' type='radio' name='rtoggle' value='dark'>
                <label for='dark'>dark</label>
                <input id='outdoors-v11' type='radio' name='rtoggle' value='outdoors'>
                <label for='outdoors'>outdoors</label>
                <input id='satellite-v9' type='radio' name='rtoggle' value='satellite'>
                <label for='satellite'>satellite</label>
            </div>
        </div>
    </div>




    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        var windowHeight = $(window).height() - 30;
        var windowWidth = $(window).width() - 30;
        var windowMinWidth = $(window).width() / 2 - 15;
        function zoomMap() {
            $("#zoomInMap").show();
            $("#zoomMap").hide();
            $(".mapItem").hide();
            console.log(1);
            $("#map").css("width", windowWidth);
            map.resize();
        }
        function zoomInMap() {
            $("#zoomInMap").hide();
            $("#zoomMap").show();
            $(".mapItem").show();
            console.log(2);
            $("#map").css("width", windowMinWidth);
            map.resize();
        }
        $(document).ready(function () {
            $("#zoomInMap").hide();
            $("#map").css("height", windowHeight);
        });
        mapboxgl.accessToken = 'pk.eyJ1IjoibWluaG50dXllbiIsImEiOiJjazEwNWkyMWcwMjRhM2hwYmVybWlmenN4In0.w81DZILIiJNnmQV4Dg6JYA';

        var x = document.getElementById("demo");
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(showPosition);
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [105.8444083, 21.004097599999998],
            zoom: 15
        });
        $(function () {
            // Getter
            var minWidth = $(".selector").resizable("option", "minWidth");
            // Setter
            $(".selector").resizable("option", "minWidth", windowMinWidth);
            // Getter
            var maxWidth = $(".selector").resizable("option", "maxWidth");
            // Setter
            $(".selector").resizable("option", "maxWidth", windowWidth);
            // Getter
            var maxHeight = $(".selector").resizable("option", "maxHeight");
            // Setter
            $(".selector").resizable("option", "maxHeight", windowHeight);
            $("#map").resizable({
                maxHeight: windowHeight,
                maxWidth: windowWidth,
                minWidth: windowMinWidth
            });
            map.resize();
        });
        $("#map").resize(function (e) {
            console.log($("#map").width());
            if ($("#map").width() > (windowMinWidth + 15)) {
                $("#map").css("z-index", 10);
            }else{
                $("#map").css("z-index", "unset");
            }
            map.resize();
        });
        map.addControl(new mapboxgl.NavigationControl());
        var layerList = document.getElementById('menu');
        var inputs = layerList.getElementsByTagName('input');

        function switchLayer(layer) {
            var layerId = layer.target.id;
            map.setStyle('mapbox://styles/mapbox/' + layerId);
        }

        for (var i = 0; i < inputs.length; i++) {
            inputs[i].onclick = switchLayer;
        }
        function showPosition(position) {
            console.log(1)
            x.innerHTML = "Latitude: " + position.coords.latitude +
                "<br>Longitude: " + position.coords.longitude;
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [position.coords.longitude, position.coords.latitude],
                zoom: 15
            });
            var size = 200;

            map.addControl(new mapboxgl.NavigationControl());
            var pulsingDot = {
                width: size,
                height: size,
                data: new Uint8Array(size * size * 4),

                onAdd: function () {
                    var canvas = document.createElement('canvas');
                    canvas.width = this.width;
                    canvas.height = this.height;
                    this.context = canvas.getContext('2d');
                },

                render: function () {
                    var duration = 1000;
                    var t = (performance.now() % duration) / duration;

                    var radius = size / 2 * 0.3;
                    var outerRadius = size / 2 * 0.7 * t + radius;
                    var context = this.context;

                    // draw outer circle
                    context.clearRect(0, 0, this.width, this.height);
                    context.beginPath();
                    context.arc(this.width / 2, this.height / 2, outerRadius, 0, Math.PI * 2);
                    context.fillStyle = 'rgba(255, 200, 200,' + (1 - t) + ')';
                    context.fill();

                    // draw inner circle
                    context.beginPath();
                    context.arc(this.width / 2, this.height / 2, radius, 0, Math.PI * 2);
                    context.fillStyle = 'rgba(255, 100, 100, 1)';
                    context.strokeStyle = 'white';
                    context.lineWidth = 2 + 4 * (1 - t);
                    context.fill();
                    context.stroke();

                    // update this image's data with data from the canvas
                    this.data = context.getImageData(0, 0, this.width, this.height).data;

                    // keep the map repainting
                    map.triggerRepaint();

                    // return `true` to let the map know that the image was updated
                    return true;
                }
            };
            map.on('load', function () {

                map.addImage('pulsing-dot', pulsingDot, { pixelRatio: 2 });

                map.addLayer({
                    "id": "points",
                    "type": "symbol",
                    "source": {
                        "type": "geojson",
                        "data": {
                            "type": "FeatureCollection",
                            "features": [{
                                "type": "Feature",
                                "geometry": {
                                    "type": "Point",
                                    "coordinates": [position.coords.longitude, position.coords.latitude]
                                }
                            }]
                        }
                    },
                    "layout": {
                        "icon-image": "pulsing-dot"
                    }
                });
            });
            var layerList = document.getElementById('menu');
            var inputs = layerList.getElementsByTagName('input');

            function switchLayer(layer) {
                var layerId = layer.target.id;
                map.setStyle('mapbox://styles/mapbox/' + layerId);
                map.on('load', function () {

                    map.addImage('pulsing-dot', pulsingDot, { pixelRatio: 2 });

                    map.addLayer({
                        "id": "points",
                        "type": "symbol",
                        "source": {
                            "type": "geojson",
                            "data": {
                                "type": "FeatureCollection",
                                "features": [{
                                    "type": "Feature",
                                    "geometry": {
                                        "type": "Point",
                                        "coordinates": [position.coords.longitude, position.coords.latitude]
                                    }
                                }]
                            }
                        },
                        "layout": {
                            "icon-image": "pulsing-dot"
                        }
                    });
                });
            }

            for (var i = 0; i < inputs.length; i++) {
                inputs[i].onclick = switchLayer;
            }
        }


    </script>
</body>

</html>